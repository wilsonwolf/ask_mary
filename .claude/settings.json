{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/protect-immutable.sh",
            "statusMessage": "Checking immutable test protection..."
          },
          {
            "type": "prompt",
            "prompt": "You are an architecture guard. Check ONLY the 5 rules below against the edit. If the edit complies with ALL rules, you MUST respond {\"ok\": true}. You MUST NOT block a compliant edit under any circumstances.\n\nRules:\n1. Files in src/agents/ must NOT import from other agent files in src/agents/.\n2. Files in src/services/ must NOT import from src/agents/.\n3. Allowed imports: api/ and workers/ CAN import from agents/, services/, db/, shared/. agents/ CAN import from services/, db/, shared/. services/ CAN import from db/, shared/. db/ CAN import from shared/ only. shared/ must NOT import from any other layer.\n4. New Python files must be in a valid src/ subdirectory (agents, api, config, db, services, shared, workers, safety).\n5. Files in tests/ are exempt from all rules.\n\nCRITICAL: If you determine the edit is compliant with all 5 rules, respond ONLY {\"ok\": true}. Never output {\"ok\": false} if you have determined compliance. Do NOT speculate about indirect imports in other files. Only check the actual code in this edit.\n\nInput: $ARGUMENTS",
            "timeout": 15
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/lint-and-format.sh",
            "statusMessage": "Running lint + format + type check..."
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/update-tracker.sh",
            "statusMessage": "Checking implementation tracker freshness..."
          },
          {
            "type": "agent",
            "prompt": "Before Claude stops, verify these documentation requirements. Use Glob and Read tools to check:\n\n1. README.md files: Run Glob for 'src/*/README.md'. Every directory directly under src/ that contains .py files MUST have a README.md. Known directories: agents, api, config, db, safety, services, shared, workers.\n\n2. Docstrings: Spot-check 2-3 recently modified .py files under src/ (not __init__.py). Public functions (no _ prefix) must have Google-style docstrings with Args/Returns.\n\n3. DRY: Check if any logic pattern appears in 3+ files that should be extracted to src/shared/.\n\nIf any README.md is missing or public functions lack docstrings, respond {\"ok\": false, \"reason\": \"Missing README.md in: [dirs]. Missing docstrings in: [files]\"}. Otherwise {\"ok\": true}.",
            "timeout": 120,
            "statusMessage": "Verifying docs + DRY compliance..."
          }
        ]
      }
    ],
    "TaskCompleted": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/enforce-tdd.sh",
            "statusMessage": "Running test suite (TDD gate)..."
          }
        ]
      }
    ]
  },
  "enabledPlugins": {
    "superpowers@claude-plugins-official": true
  }
}
